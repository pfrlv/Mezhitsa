var Modalus = (function() {
  'use strict';
  
  var defaults = {
    'openModalBtn': 'rules-link a',
    'modalContainer': 'rules-modal',
    'modalCloseBtn': 'rules-modal-close'
  };

  var $openBtn = document.querySelector( '.' + defaults.openModalBtn ),
      $closeBtn = document.querySelector( '.' + defaults.modalCloseBtn ),
      $modalContainer = document.querySelector( '#' + defaults.modalContainer ),
      $body = document.body;

  $modalContainer.style.display = 'none';

  $openBtn.addEventListener('click', function( even ) {
    even.preventDefault();

    if ( !hasclass($body, 'show-rules-modal') ) {
      $modalContainer.style.display = 'block';

      setTimeout(function() {
        $body.classList.add('show-rules-modal');
      }, 1);
    }
  }, false);

  window.addEventListener('keyup', function( event ) { 
    if ( event.shiftKey && event.keyCode === 191 ) {
      $modalContainer.style.display = 'block';

      setTimeout(function() {
        $body.classList.add('show-rules-modal');
      }, 1);
    }
  }, false); 

  $modalContainer.addEventListener('click', function( event ) {
    if ( hasclass(event.target, defaults.modalCloseBtn) ) {
        $body.removeAttribute('class');

        setTimeout(function() {
          $modalContainer.style.display = 'none';
        }, 200);
      }
  }, false);

  window.addEventListener('keyup', function( event ) { 
    if( event.keyCode === 27 ) {
      $body.removeAttribute('class');

      setTimeout(function() {
        $modalContainer.style.display = 'none';
      }, 200);
    } 
  }, false);

  return {
    init: function() {
      if( arguments[0] && typeof arguments[0] === 'object' ) {
        defaults = extend( defaults, arguments[0] );
      }
    }
  };

})();

function hasclass ( el, classname ) {
  var result = el.classList ? el.classList.contains(classname) : new RegExp('(^| )' + className + '( |$)', 'gi').test(el.className);
  return result;
};

// Disable :hover on touch devices
//
// Based on https://gist.github.com/4404503 
// via https://twitter.com/javan/status/284873379062890496
// + https://twitter.com/pennig/status/285790598642946048
// re http://retrogamecrunch.com/tmp/hover
if ( 'createTouch' in document ) {
  try {
    var ignore = /:hover/;
    for ( var i=0; i<document.styleSheets.length; i++ ) {
      var sheet = document.styleSheets[i];
      for ( var j=sheet.cssRules.length-1; j>=0; j-- ) {
        var rule = sheet.cssRules[j];
          if (rule.type === CSSRule.STYLE_RULE && ignore.test(rule.selectorText)) {
            sheet.deleteRule( j );
          }
      }
    }
  }
  catch( e ){}
};
function extend( source, properties ) {
  var property;
  for( property in properties ) {
    if( properties.hasOwnProperty(property) ) {
      source[property] = properties[property];
    }
  }
  return source;
};
Modalus.init();